import os


l = ['./doitgen_MEDIUM_evaluation/only_nlp8', './doitgen_MEDIUM_evaluation/only_nlp5', './doitgen_MEDIUM_evaluation/only_nlp10', './doitgen_MEDIUM_evaluation/only_nlp2', './doitgen_MEDIUM_evaluation/only_nlp13', './doitgen_MEDIUM_evaluation/only_nlp12', './doitgen_MEDIUM_evaluation/only_nlp7', './doitgen_MEDIUM_evaluation/only_nlp3', './doitgen_MEDIUM_evaluation/only_nlp4', './doitgen_MEDIUM_evaluation/only_nlp6', './doitgen_MEDIUM_evaluation/only_nlp1', './doitgen_MEDIUM_evaluation/only_nlp9', './doitgen_MEDIUM_evaluation/only_nlp11', './bert_100_64_evaluation/only_nlp8', './bert_100_64_evaluation/only_nlp19', './bert_100_64_evaluation/only_nlp16', './bert_100_64_evaluation/only_nlp5', './bert_100_64_evaluation/only_nlp15', './bert_100_64_evaluation/only_nlp20', './bert_100_64_evaluation/only_nlp10', './bert_100_64_evaluation/only_nlp2', './bert_100_64_evaluation/only_nlp13', './bert_100_64_evaluation/only_nlp18', './bert_100_64_evaluation/only_nlp12', './bert_100_64_evaluation/only_nlp7', './bert_100_64_evaluation/only_nlp3', './bert_100_64_evaluation/only_nlp14', './bert_100_64_evaluation/only_nlp4', './bert_100_64_evaluation/only_nlp17', './bert_100_64_evaluation/only_nlp6', './bert_100_64_evaluation/only_nlp1', './bert_100_64_evaluation/only_nlp21', './bert_100_64_evaluation/only_nlp9', './bert_100_64_evaluation/only_nlp11', './syrk_MEDIUM_evaluation/only_nlp8', './syrk_MEDIUM_evaluation/only_nlp16', './syrk_MEDIUM_evaluation/only_nlp5', './syrk_MEDIUM_evaluation/only_nlp15', './syrk_MEDIUM_evaluation/only_nlp10', './syrk_MEDIUM_evaluation/only_nlp2', './syrk_MEDIUM_evaluation/only_nlp13', './syrk_MEDIUM_evaluation/only_nlp12', './syrk_MEDIUM_evaluation/only_nlp7', './syrk_MEDIUM_evaluation/only_nlp3', './syrk_MEDIUM_evaluation/only_nlp14', './syrk_MEDIUM_evaluation/only_nlp4', './syrk_MEDIUM_evaluation/only_nlp6', './syrk_MEDIUM_evaluation/only_nlp1', './syrk_MEDIUM_evaluation/only_nlp9', './syrk_MEDIUM_evaluation/only_nlp11', './bert_100_768_evaluation/only_nlp8', './bert_100_768_evaluation/only_nlp19', './bert_100_768_evaluation/only_nlp16', './bert_100_768_evaluation/only_nlp5', './bert_100_768_evaluation/only_nlp15', './bert_100_768_evaluation/only_nlp20', './bert_100_768_evaluation/only_nlp10', './bert_100_768_evaluation/only_nlp2', './bert_100_768_evaluation/only_nlp13', './bert_100_768_evaluation/only_nlp18', './bert_100_768_evaluation/only_nlp12', './bert_100_768_evaluation/only_nlp7', './bert_100_768_evaluation/only_nlp3', './bert_100_768_evaluation/only_nlp14', './bert_100_768_evaluation/only_nlp4', './bert_100_768_evaluation/only_nlp17', './bert_100_768_evaluation/only_nlp6', './bert_100_768_evaluation/only_nlp1', './bert_100_768_evaluation/only_nlp21', './bert_100_768_evaluation/only_nlp9', './bert_100_768_evaluation/only_nlp11', './syr2k_MEDIUM_evaluation/only_nlp8', './syr2k_MEDIUM_evaluation/only_nlp16', './syr2k_MEDIUM_evaluation/only_nlp5', './syr2k_MEDIUM_evaluation/only_nlp15', './syr2k_MEDIUM_evaluation/only_nlp10', './syr2k_MEDIUM_evaluation/only_nlp2', './syr2k_MEDIUM_evaluation/only_nlp13', './syr2k_MEDIUM_evaluation/only_nlp12', './syr2k_MEDIUM_evaluation/only_nlp7', './syr2k_MEDIUM_evaluation/only_nlp3', './syr2k_MEDIUM_evaluation/only_nlp14', './syr2k_MEDIUM_evaluation/only_nlp4', './syr2k_MEDIUM_evaluation/only_nlp6', './syr2k_MEDIUM_evaluation/only_nlp1', './syr2k_MEDIUM_evaluation/only_nlp9', './syr2k_MEDIUM_evaluation/only_nlp11', './gesummv_MEDIUM_evaluation/only_nlp8', './gesummv_MEDIUM_evaluation/only_nlp5', './gesummv_MEDIUM_evaluation/only_nlp10', './gesummv_MEDIUM_evaluation/only_nlp2', './gesummv_MEDIUM_evaluation/only_nlp13', './gesummv_MEDIUM_evaluation/only_nlp12', './gesummv_MEDIUM_evaluation/only_nlp7', './gesummv_MEDIUM_evaluation/only_nlp3', './gesummv_MEDIUM_evaluation/only_nlp14', './gesummv_MEDIUM_evaluation/only_nlp4', './gesummv_MEDIUM_evaluation/only_nlp6', './gesummv_MEDIUM_evaluation/only_nlp1', './gesummv_MEDIUM_evaluation/only_nlp9', './gesummv_MEDIUM_evaluation/only_nlp11', './symm_MEDIUM_evaluation/only_nlp5', './symm_MEDIUM_evaluation/only_nlp2', './symm_MEDIUM_evaluation/only_nlp111', './symm_MEDIUM_evaluation/only_nlp3', './symm_MEDIUM_evaluation/only_nlp4', './symm_MEDIUM_evaluation/only_nlp1', './atax_MEDIUM_evaluation/only_nlp8', './atax_MEDIUM_evaluation/only_nlp5', './atax_MEDIUM_evaluation/only_nlp10', './atax_MEDIUM_evaluation/only_nlp2', './atax_MEDIUM_evaluation/only_nlp7', './atax_MEDIUM_evaluation/only_nlp3', './atax_MEDIUM_evaluation/only_nlp4', './atax_MEDIUM_evaluation/only_nlp6', './atax_MEDIUM_evaluation/only_nlp1', './atax_MEDIUM_evaluation/only_nlp9', './mvt_MEDIUM_evaluation/only_nlp8', './mvt_MEDIUM_evaluation/only_nlp16', './mvt_MEDIUM_evaluation/only_nlp5', './mvt_MEDIUM_evaluation/only_nlp15', './mvt_MEDIUM_evaluation/only_nlp10', './mvt_MEDIUM_evaluation/only_nlp2', './mvt_MEDIUM_evaluation/only_nlp13', './mvt_MEDIUM_evaluation/only_nlp18', './mvt_MEDIUM_evaluation/only_nlp12', './mvt_MEDIUM_evaluation/only_nlp7', './mvt_MEDIUM_evaluation/only_nlp3', './mvt_MEDIUM_evaluation/only_nlp14', './mvt_MEDIUM_evaluation/only_nlp4', './mvt_MEDIUM_evaluation/only_nlp17', './mvt_MEDIUM_evaluation/only_nlp6', './mvt_MEDIUM_evaluation/only_nlp1', './mvt_MEDIUM_evaluation/only_nlp9', './mvt_MEDIUM_evaluation/only_nlp11', './bert_100_3072_evaluation/only_nlp8', './bert_100_3072_evaluation/only_nlp16', './bert_100_3072_evaluation/only_nlp5', './bert_100_3072_evaluation/only_nlp15', './bert_100_3072_evaluation/only_nlp10', './bert_100_3072_evaluation/only_nlp2', './bert_100_3072_evaluation/only_nlp13', './bert_100_3072_evaluation/only_nlp18', './bert_100_3072_evaluation/only_nlp12', './bert_100_3072_evaluation/only_nlp7', './bert_100_3072_evaluation/only_nlp3', './bert_100_3072_evaluation/only_nlp14', './bert_100_3072_evaluation/only_nlp4', './bert_100_3072_evaluation/only_nlp17', './bert_100_3072_evaluation/only_nlp6', './bert_100_3072_evaluation/only_nlp1', './bert_100_3072_evaluation/only_nlp9', './bert_100_3072_evaluation/only_nlp11', './2mm_MEDIUM_evaluation/only_nlp8', './2mm_MEDIUM_evaluation/only_nlp16', './2mm_MEDIUM_evaluation/only_nlp5', './2mm_MEDIUM_evaluation/only_nlp15', './2mm_MEDIUM_evaluation/only_nlp10', './2mm_MEDIUM_evaluation/only_nlp2', './2mm_MEDIUM_evaluation/only_nlp13', './2mm_MEDIUM_evaluation/only_nlp18', './2mm_MEDIUM_evaluation/only_nlp12', './2mm_MEDIUM_evaluation/only_nlp7', './2mm_MEDIUM_evaluation/only_nlp3', './2mm_MEDIUM_evaluation/only_nlp14', './2mm_MEDIUM_evaluation/only_nlp4', './2mm_MEDIUM_evaluation/only_nlp17', './2mm_MEDIUM_evaluation/only_nlp6', './2mm_MEDIUM_evaluation/only_nlp1', './2mm_MEDIUM_evaluation/only_nlp9', './2mm_MEDIUM_evaluation/only_nlp11', './gemver_MEDIUM_evaluation/only_nlp8', './gemver_MEDIUM_evaluation/only_nlp19', './gemver_MEDIUM_evaluation/only_nlp16', './gemver_MEDIUM_evaluation/only_nlp5', './gemver_MEDIUM_evaluation/only_nlp15', './gemver_MEDIUM_evaluation/only_nlp20', './gemver_MEDIUM_evaluation/only_nlp10', './gemver_MEDIUM_evaluation/only_nlp2', './gemver_MEDIUM_evaluation/only_nlp13', './gemver_MEDIUM_evaluation/only_nlp18', './gemver_MEDIUM_evaluation/only_nlp12', './gemver_MEDIUM_evaluation/only_nlp7', './gemver_MEDIUM_evaluation/only_nlp3', './gemver_MEDIUM_evaluation/only_nlp14', './gemver_MEDIUM_evaluation/only_nlp4', './gemver_MEDIUM_evaluation/only_nlp17', './gemver_MEDIUM_evaluation/only_nlp6', './gemver_MEDIUM_evaluation/only_nlp1', './gemver_MEDIUM_evaluation/only_nlp21', './gemver_MEDIUM_evaluation/only_nlp9', './gemver_MEDIUM_evaluation/only_nlp11', './3mm_MEDIUM_evaluation/only_nlp8', './3mm_MEDIUM_evaluation/only_nlp19', './3mm_MEDIUM_evaluation/only_nlp16', './3mm_MEDIUM_evaluation/only_nlp5', './3mm_MEDIUM_evaluation/only_nlp15', './3mm_MEDIUM_evaluation/only_nlp10', './3mm_MEDIUM_evaluation/only_nlp2', './3mm_MEDIUM_evaluation/only_nlp13', './3mm_MEDIUM_evaluation/only_nlp18', './3mm_MEDIUM_evaluation/only_nlp12', './3mm_MEDIUM_evaluation/only_nlp7', './3mm_MEDIUM_evaluation/only_nlp3', './3mm_MEDIUM_evaluation/only_nlp14', './3mm_MEDIUM_evaluation/only_nlp4', './3mm_MEDIUM_evaluation/only_nlp17', './3mm_MEDIUM_evaluation/only_nlp6', './3mm_MEDIUM_evaluation/only_nlp1', './3mm_MEDIUM_evaluation/only_nlp9', './3mm_MEDIUM_evaluation/only_nlp11', './bicg_MEDIUM_evaluation/only_nlp8', './bicg_MEDIUM_evaluation/only_nlp5', './bicg_MEDIUM_evaluation/only_nlp10', './bicg_MEDIUM_evaluation/only_nlp2', './bicg_MEDIUM_evaluation/only_nlp12', './bicg_MEDIUM_evaluation/only_nlp7', './bicg_MEDIUM_evaluation/only_nlp3', './bicg_MEDIUM_evaluation/only_nlp4', './bicg_MEDIUM_evaluation/only_nlp6', './bicg_MEDIUM_evaluation/only_nlp1', './bicg_MEDIUM_evaluation/only_nlp9', './bicg_MEDIUM_evaluation/only_nlp11', './gemm_MEDIUM_evaluation/only_nlp8', './gemm_MEDIUM_evaluation/only_nlp19', './gemm_MEDIUM_evaluation/only_nlp16', './gemm_MEDIUM_evaluation/only_nlp5', './gemm_MEDIUM_evaluation/only_nlp15', './gemm_MEDIUM_evaluation/only_nlp20', './gemm_MEDIUM_evaluation/only_nlp10', './gemm_MEDIUM_evaluation/only_nlp2', './gemm_MEDIUM_evaluation/only_nlp13', './gemm_MEDIUM_evaluation/only_nlp18', './gemm_MEDIUM_evaluation/only_nlp12', './gemm_MEDIUM_evaluation/only_nlp7', './gemm_MEDIUM_evaluation/only_nlp3', './gemm_MEDIUM_evaluation/only_nlp14', './gemm_MEDIUM_evaluation/only_nlp4', './gemm_MEDIUM_evaluation/only_nlp17', './gemm_MEDIUM_evaluation/only_nlp6', './gemm_MEDIUM_evaluation/only_nlp1', './gemm_MEDIUM_evaluation/only_nlp21', './gemm_MEDIUM_evaluation/only_nlp9', './gemm_MEDIUM_evaluation/only_nlp11', './cnn_nlp_dse_without/only_nlp8', './cnn_nlp_dse_without/only_nlp5', './cnn_nlp_dse_without/only_nlp2', './cnn_nlp_dse_without/only_nlp7', './cnn_nlp_dse_without/only_nlp3', './cnn_nlp_dse_without/only_nlp4', './cnn_nlp_dse_without/only_nlp6', './cnn_nlp_dse_without/only_nlp1', './trmm_MEDIUM_evaluation/only_nlp8', './trmm_MEDIUM_evaluation/only_nlp16', './trmm_MEDIUM_evaluation/only_nlp5', './trmm_MEDIUM_evaluation/only_nlp15', './trmm_MEDIUM_evaluation/only_nlp10', './trmm_MEDIUM_evaluation/only_nlp2', './trmm_MEDIUM_evaluation/only_nlp13', './trmm_MEDIUM_evaluation/only_nlp12', './trmm_MEDIUM_evaluation/only_nlp7', './trmm_MEDIUM_evaluation/only_nlp3', './trmm_MEDIUM_evaluation/only_nlp14', './trmm_MEDIUM_evaluation/only_nlp4', './trmm_MEDIUM_evaluation/only_nlp17', './trmm_MEDIUM_evaluation/only_nlp6', './trmm_MEDIUM_evaluation/only_nlp1', './trmm_MEDIUM_evaluation/only_nlp9', './trmm_MEDIUM_evaluation/only_nlp11', './cnn_nlp_dse/only_nlp8', './cnn_nlp_dse/only_nlp5', './cnn_nlp_dse/only_nlp2', './cnn_nlp_dse/only_nlp7', './cnn_nlp_dse/only_nlp3', './cnn_nlp_dse/only_nlp4', './cnn_nlp_dse/only_nlp6', './cnn_nlp_dse/only_nlp1']


import os
import subprocess
from concurrent.futures import ThreadPoolExecutor, as_completed
from functools import partial



# Number of threads
num_threads = 27

# Timeout in seconds (3 hours)
timeout = 3 * 60 * 60

def execute_command(folder, timeout):
    try:
        # Change directory and execute the command
        result = subprocess.run(
            ["make", "mcc_estimate"],
            cwd=folder,
            timeout=timeout,
            text=True,
            capture_output=True
        )
        # Log success or error
        if result.returncode == 0:
            print(f"Success in {folder}: {result.stdout}")
        else:
            print(f"Error in {folder}: {result.stderr}")
    except subprocess.TimeoutExpired:
        print(f"Timeout in {folder} after {timeout} seconds.")
    except Exception as e:
        print(f"Failed in {folder}: {e}")

# Partial function to include timeout
execute_with_timeout = partial(execute_command, timeout=timeout)

# Thread pool execution
with ThreadPoolExecutor(max_workers=num_threads) as executor:
    future_to_folder = {executor.submit(execute_with_timeout, folder): folder for folder in l}
    
    for future in as_completed(future_to_folder):
        folder = future_to_folder[future]
        try:
            future.result()  # Retrieve the result to raise any exceptions
        except Exception as exc:
            print(f"Execution failed for {folder}: {exc}")